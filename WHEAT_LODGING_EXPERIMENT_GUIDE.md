# å°éº¦å€’ä¼åˆ†å‰²ä¸“é—¨å®éªŒæ–¹æ¡ˆ
# Wheat Lodging Segmentation Specialized Experiment Guide

## ğŸŒ¾ å®éªŒæ¦‚è¿°

æœ¬å®éªŒæ–¹æ¡ˆä¸“é—¨é’ˆå¯¹å°éº¦å€’ä¼åˆ†å‰²ä»»åŠ¡è®¾è®¡ï¼Œé€šè¿‡ç³»ç»Ÿæ€§çš„å®éªŒéªŒè¯ä¸åŒå½¢çŠ¶å…ˆéªŒæ–¹æ³•çš„æœ‰æ•ˆæ€§ã€‚

## ğŸ“‹ å®éªŒè®¾è®¡

### **é˜¶æ®µ1: åŸºçº¿å¯¹æ¯”å®éªŒ**
**ç›®æ ‡**: å»ºç«‹æ€§èƒ½åŸºå‡†ï¼ŒéªŒè¯å½¢çŠ¶å…ˆéªŒçš„å¿…è¦æ€§

| å®éªŒåç§° | å½¢çŠ¶ç±»å‹ | æè¿° | é¢„æœŸæ•ˆæœ |
|---------|---------|------|---------|
| baseline | æ—  | åŸå§‹DFormerï¼Œæ— å½¢çŠ¶çº¦æŸ | æ€§èƒ½åŸºå‡† |
| ccs_star | æ˜Ÿå½¢ | æ˜Ÿå½¢å½¢çŠ¶å…ˆéªŒ | éªŒè¯é€šç”¨å½¢çŠ¶çº¦æŸ |
| wheat_bar | æ¡çŠ¶ | æ¡çŠ¶å½¢çŠ¶å…ˆéªŒï¼ˆæ­£å¸¸å°éº¦ï¼‰ | éªŒè¯æ¡çŠ¶çº¦æŸ |
| wheat_diffusion | æ‰©æ•£ | æ‰©æ•£å½¢çŠ¶å…ˆéªŒï¼ˆå€’ä¼å°éº¦ï¼‰ | éªŒè¯æ‰©æ•£çº¦æŸ |

### **é˜¶æ®µ2: å½¢çŠ¶å…ˆéªŒç±»å‹å¯¹æ¯”**
**ç›®æ ‡**: æ·±å…¥åˆ†æä¸åŒå½¢çŠ¶å…ˆéªŒçš„é€‚ç”¨æ€§

#### **æ¡çŠ¶å½¢çŠ¶å˜ä½“**
- `bar_vertical`: å‚ç›´æ¡çŠ¶ï¼ˆæ­£å¸¸å°éº¦ï¼‰
- `bar_diagonal`: å¯¹è§’æ¡çŠ¶ï¼ˆå€¾æ–œå°éº¦ï¼‰
- `bar_learnable`: å­¦ä¹ æ¡çŠ¶æ–¹å‘

#### **æ‰©æ•£å½¢çŠ¶å˜ä½“**
- `diffusion_small`: å°èŒƒå›´æ‰©æ•£
- `diffusion_large`: å¤§èŒƒå›´æ‰©æ•£
- `diffusion_learnable`: å­¦ä¹ æ‰©æ•£åŠå¾„

#### **æ··åˆå½¢çŠ¶**
- `mixed_adaptive`: è‡ªé€‚åº”æ··åˆå½¢çŠ¶

### **é˜¶æ®µ3: å‚æ•°æ•æ„Ÿæ€§åˆ†æ**
**ç›®æ ‡**: æ‰¾åˆ°æœ€ä¼˜å‚æ•°ç»„åˆ

#### **ä¸­å¿ƒæ•°é‡åˆ†æ**
- 1, 2, 3, 5, 7ä¸ªä¸­å¿ƒ

#### **æƒé‡å‚æ•°åˆ†æ**
- è½»é‡çº§: Î»=0.01, Î¼=0.01
- ä¸­ç­‰: Î»=0.05, Î¼=0.05
- å¼ºåŒ–: Î»=0.1, Î¼=0.1
- æå¼º: Î»=0.2, Î¼=0.2

#### **æ¸©åº¦å‚æ•°åˆ†æ**
- é”åˆ©: Ï„=0.5
- æ ‡å‡†: Ï„=1.0
- å¹³æ»‘: Ï„=2.0

### **é˜¶æ®µ4: æ··åˆç­–ç•¥ä¼˜åŒ–**
**ç›®æ ‡**: ç»“åˆå¤šç§ç­–ç•¥ï¼Œè¾¾åˆ°æœ€ä½³æ€§èƒ½

#### **æ¸è¿›å¼è®­ç»ƒ**
- é˜¶æ®µ1: çº¯è¯­ä¹‰å­¦ä¹ ï¼ˆ50 epochsï¼‰
- é˜¶æ®µ2: å¼•å…¥å½¢çŠ¶çº¦æŸï¼ˆ50 epochsï¼‰
- é˜¶æ®µ3: å¼ºåŒ–å½¢çŠ¶çº¦æŸï¼ˆ50 epochsï¼‰

#### **å¤šå°ºåº¦å½¢çŠ¶å…ˆéªŒ**
- å°å°ºåº¦: 2ä¸­å¿ƒï¼ŒåŠå¾„[5,15]
- ä¸­å°ºåº¦: 3ä¸­å¿ƒï¼ŒåŠå¾„[10,30]
- å¤§å°ºåº¦: 2ä¸­å¿ƒï¼ŒåŠå¾„[20,50]

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### **1. å¿«é€Ÿæµ‹è¯•**
```bash
# æŸ¥çœ‹å®éªŒè®¡åˆ’ï¼ˆä¸å®é™…è¿è¡Œï¼‰
bash test_wheat_lodging_quick.sh
```

### **2. è¿è¡Œå•ä¸ªé˜¶æ®µ**
```bash
# è¿è¡Œé˜¶æ®µ1ï¼šåŸºçº¿å¯¹æ¯”å®éªŒ
python experiments/wheat_lodging_experiment.py --stage stage1_baseline

# è¿è¡Œé˜¶æ®µ2ï¼šå½¢çŠ¶ç±»å‹å¯¹æ¯”
python experiments/wheat_lodging_experiment.py --stage stage2_shape_types

# è¿è¡Œé˜¶æ®µ3ï¼šå‚æ•°åˆ†æ
python experiments/wheat_lodging_experiment.py --stage stage3_parameter_analysis

# è¿è¡Œé˜¶æ®µ4ï¼šæ··åˆä¼˜åŒ–
python experiments/wheat_lodging_experiment.py --stage stage4_hybrid_optimization
```

### **3. è¿è¡Œæ‰€æœ‰å®éªŒ**
```bash
# è¿è¡Œå®Œæ•´å®éªŒå¥—ä»¶
bash run_wheat_lodging_experiments.sh
```

### **4. å¹²è¿è¡Œæ¨¡å¼**
```bash
# æŸ¥çœ‹å®éªŒè®¡åˆ’è€Œä¸å®é™…è®­ç»ƒ
python experiments/wheat_lodging_experiment.py --stage stage1_baseline --dry-run
```

## ğŸ“Š å®éªŒç»“æœåˆ†æ

### **å…³é”®æŒ‡æ ‡**
- **mIoU**: å¹³å‡äº¤å¹¶æ¯”
- **è®­ç»ƒæ—¶é—´**: æ”¶æ•›æ—¶é—´
- **å½¢çŠ¶ä¸€è‡´æ€§**: åˆ†å‰²ç»“æœçš„å‡ ä½•åˆç†æ€§
- **è¾¹ç•Œè´¨é‡**: åˆ†å‰²è¾¹ç•Œçš„å¹³æ»‘åº¦

### **åˆ†æå·¥å…·**
```bash
# ç”Ÿæˆåˆ†ææŠ¥å‘Š
python experiments/wheat_lodging_experiment.py --stage stage1_baseline
# æŠ¥å‘Šå°†è‡ªåŠ¨ä¿å­˜åˆ° experiments/wheat_lodging/stage1_baseline_report.md
```

### **ç»“æœæ–‡ä»¶ç»“æ„**
```
experiments/wheat_lodging/
â”œâ”€â”€ stage1_baseline/
â”‚   â”œâ”€â”€ baseline/
â”‚   â”œâ”€â”€ ccs_star/
â”‚   â”œâ”€â”€ wheat_bar/
â”‚   â””â”€â”€ wheat_diffusion/
â”œâ”€â”€ stage2_shape_types/
â”œâ”€â”€ stage3_parameter_analysis/
â”œâ”€â”€ stage4_hybrid_optimization/
â””â”€â”€ results/
    â”œâ”€â”€ stage1_baseline_results.json
    â”œâ”€â”€ stage2_shape_types_results.json
    â””â”€â”€ ...
```

## ğŸ¯ é¢„æœŸç»“æœ

### **é˜¶æ®µ1é¢„æœŸ**
- éªŒè¯å½¢çŠ¶å…ˆéªŒæ˜¯å¦å¯¹å°éº¦å€’ä¼åˆ†å‰²æœ‰æ•ˆ
- ç¡®å®šå“ªç§åŸºç¡€å½¢çŠ¶ç±»å‹æœ€é€‚åˆ

### **é˜¶æ®µ2é¢„æœŸ**
- æ‰¾åˆ°æœ€é€‚åˆå°éº¦å€’ä¼çš„å½¢çŠ¶å…ˆéªŒç±»å‹
- éªŒè¯æ¡çŠ¶vsæ‰©æ•£å½¢çŠ¶çš„é€‚ç”¨æ€§

### **é˜¶æ®µ3é¢„æœŸ**
- ç¡®å®šæœ€ä¼˜å‚æ•°ç»„åˆ
- ç†è§£å‚æ•°å¯¹æ€§èƒ½çš„å½±å“

### **é˜¶æ®µ4é¢„æœŸ**
- è¾¾åˆ°æœ€ä½³åˆ†å‰²æ€§èƒ½
- éªŒè¯æ··åˆç­–ç•¥çš„æœ‰æ•ˆæ€§

## ğŸ”§ è‡ªå®šä¹‰å®éªŒ

### **ä¿®æ”¹å®éªŒå‚æ•°**
ç¼–è¾‘ `experiments/wheat_lodging_experiment.py` ä¸­çš„ `_define_experiments()` æ–¹æ³•ï¼š

```python
def _define_experiments(self):
    return {
        "custom_stage": {
            "name": "è‡ªå®šä¹‰å®éªŒ",
            "description": "æ‚¨çš„è‡ªå®šä¹‰å®éªŒæè¿°",
            "experiments": {
                "custom_exp": {
                    "use_shape_prior": True,
                    "shape_type": "custom",
                    "num_centers": 3,
                    "description": "è‡ªå®šä¹‰å®éªŒé…ç½®"
                }
            }
        }
    }
```

### **æ·»åŠ æ–°çš„å½¢çŠ¶ç±»å‹**
1. åœ¨ `models/wheat_lodging_shape_prior.py` ä¸­å®ç°æ–°çš„å½¢çŠ¶ç±»
2. åœ¨å®éªŒé…ç½®ä¸­æ·»åŠ å¯¹åº”çš„å‚æ•°
3. æ›´æ–°é…ç½®æ–‡ä»¶ç”Ÿæˆé€»è¾‘

## ğŸ“ˆ å®éªŒç›‘æ§

### **å®æ—¶ç›‘æ§**
```bash
# ç›‘æ§GPUä½¿ç”¨æƒ…å†µ
watch -n 1 nvidia-smi

# ç›‘æ§è®­ç»ƒæ—¥å¿—
tail -f experiments/wheat_lodging/*/log_*.log
```

### **ç»“æœå¯è§†åŒ–**
å®éªŒå®Œæˆåï¼Œç»“æœå°†åŒ…å«ï¼š
- æ€§èƒ½å¯¹æ¯”å›¾è¡¨
- å‚æ•°æ•æ„Ÿæ€§åˆ†æ
- å½¢çŠ¶çº¦æŸæ•ˆæœå¯è§†åŒ–
- åˆ†å‰²ç»“æœå¯¹æ¯”

## ğŸ‰ å®éªŒå®Œæˆåçš„å·¥ä½œ

1. **åˆ†æç»“æœ**: æŸ¥çœ‹å„é˜¶æ®µçš„å®éªŒç»“æœ
2. **é€‰æ‹©æœ€ä½³é…ç½®**: åŸºäºæ€§èƒ½æŒ‡æ ‡é€‰æ‹©æœ€ä¼˜å‚æ•°
3. **ç”Ÿæˆè®ºæ–‡å›¾è¡¨**: ä½¿ç”¨ç»“æœç”Ÿæˆè®ºæ–‡çº§åˆ«çš„å›¾è¡¨
4. **æ’°å†™å®éªŒæŠ¥å‘Š**: æ€»ç»“å®éªŒå‘ç°å’Œç»“è®º

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `models/wheat_lodging_shape_prior.py`: å°éº¦å€’ä¼å½¢çŠ¶å…ˆéªŒå®ç°
- `experiments/wheat_lodging_experiment.py`: å®éªŒç®¡ç†å™¨
- `run_wheat_lodging_experiments.sh`: å®Œæ•´å®éªŒè¿è¡Œè„šæœ¬
- `test_wheat_lodging_quick.sh`: å¿«é€Ÿæµ‹è¯•è„šæœ¬

---

**æ³¨æ„**: å®Œæ•´å®éªŒå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼ˆæ•°å°æ—¶åˆ°æ•°å¤©ï¼‰ï¼Œå»ºè®®å…ˆè¿è¡Œå¿«é€Ÿæµ‹è¯•äº†è§£å®éªŒè®¡åˆ’ã€‚
